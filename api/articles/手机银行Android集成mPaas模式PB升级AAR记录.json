{"title":"手机银行Android集成mPaas模式PB升级AAR记录","uid":"bfc305b99c5cb0bd679dca33789b927d","slug":"手机银行Android集成mPaas模式PB升级AAR记录","date":"2023-02-03T12:14:10.000Z","updated":"2023-03-01T07:39:03.882Z","comments":true,"path":"api/articles/手机银行Android集成mPaas模式PB升级AAR记录.json","keywords":null,"cover":"/post/手机银行Android集成mPaas模式PB升级AAR记录/cover.jpeg","content":"<p>mPaas目前接入方式有两种，分别是<strong>原生AAR模式</strong>和<strong>组件化方式（Portal&amp;Bundle）</strong>，AAR模式为后期mPaas推出，手机银行4.0采用的为PB模式。</p>\n<h2 id=\"原生-AAR-方式\"><a href=\"#原生-AAR-方式\" class=\"headerlink\" title=\"原生 AAR 方式\"></a>原生 AAR 方式</h2><p><strong>原生 AAR 接入方式</strong> 是指采用原生 Android AAR 打包方案，更贴近 Android 开发者的技术栈。开发者无需了解 mPaaS 相关的打包知识，通过 mPaaS Android Studio 插件，或者直接通过 Maven 的 pom 和 bom，即可将 mPaaS 集成到开发者的项目中来。该方式降低了开发者的接入成本，能够让开发者更轻松地使用 mPaaS，适合对 <strong>组件化（Portal&amp;Bundle）接入方式</strong> 没有特别需求，想快速使用 mPaaS 能力的客户。</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><strong>说明</strong> </p>\n<p>原生 AAR 接入方式从 10.1.68 起开始支持。</p></blockquote>\n<h2 id=\"组件化方式（Portal-amp-Bundle）\"><a href=\"#组件化方式（Portal-amp-Bundle）\" class=\"headerlink\" title=\"组件化方式（Portal&amp;Bundle）\"></a>组件化方式（Portal&amp;Bundle）</h2><p><strong>组件化方式</strong> 是指 mPaaS 基于 OSGi（Open Service Gateway Initiative，开放服务网关倡议）技术将一个 App 划分成业务独立的一个或多个 Bundle 工程以及一个 Portal 工程的框架。mPaaS 会对每个 Bundle 工程的生命周期和依赖加以管理，使用 Portal 工程把所有的 Bundle 工程包合并成一个可运行的 <code>.apk</code> 包。该方式适用于大型多人并行开发项目。使用 <strong>组件化方式</strong>，需要引入 mPaaS gradle 打包工具，对 gradle 版本以及<code>com.android.tools.build:gradle</code> 版本有一定的要求。</p>\n<h2 id=\"如何选择接入方式\"><a href=\"#如何选择接入方式\" class=\"headerlink\" title=\"如何选择接入方式\"></a>如何选择接入方式</h2><p>如果使用 mPaaS 需要像使用其他 SDK 一样简单接入并使用，推荐使用 <strong>原生 AAR 方式</strong>。如果使用 mPaaS 来重构您的项目需要引入大规模并行研发的理念，推荐使用 <strong>组件化方式</strong> 。</p>\n<h3 id=\"接入方式对比\"><a href=\"#接入方式对比\" class=\"headerlink\" title=\"接入方式对比\"></a>接入方式对比</h3><table>\n<thead>\n<tr>\n<th></th>\n<th>原生 AAR 接入</th>\n<th>组件化接入</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>来源</td>\n<td>Google 官方接入方式。</td>\n<td>源自支付宝。</td>\n</tr>\n<tr>\n<td>打包速度</td>\n<td>三者之中打包最慢，和原生接入一模一样。</td>\n<td>打包速度快，打包时间分散。</td>\n</tr>\n<tr>\n<td>项目组成方式</td>\n<td>App module 和 library module。</td>\n<td>Portal（一个 App 的壳）和 Bundle（各种业务组件）。</td>\n</tr>\n<tr>\n<td>依赖 Gradle 版本</td>\n<td>可以升级到官方最新版本，目前是 Gradle 7.x。</td>\n<td>4.4/6.3。开发者不可擅自升级。</td>\n</tr>\n<tr>\n<td>依赖 AGP1 工具链</td>\n<td>可以升级到官方最新版本，目前是 AGP 7.0.3。</td>\n<td>AGP 3.0.1/3.5.x（开发者不可擅自升级）。</td>\n</tr>\n<tr>\n<td>Android Support Library</td>\n<td>可使用。</td>\n<td>必须使用 mPaaS 提供的版本（23），开发者不可擅自升级。</td>\n</tr>\n<tr>\n<td>Android X</td>\n<td>完整支持2</td>\n<td>不支持</td>\n</tr>\n<tr>\n<td>databinding</td>\n<td>完整支持</td>\n<td>v1</td>\n</tr>\n<tr>\n<td>kotlin</td>\n<td>完整支持</td>\n<td>尽量不要使用</td>\n</tr>\n</tbody></table>\n<h4 id=\"手机银行由PB模式升级为AAR模式\"><a href=\"#手机银行由PB模式升级为AAR模式\" class=\"headerlink\" title=\"手机银行由PB模式升级为AAR模式\"></a>手机银行由PB模式升级为AAR模式</h4><ul>\n<li><p>首先替换gradle</p>\n<ul>\n<li><p>distributionUrl=https://<a href=\"http://services.gradle.org/distributions/gradle-5.6.4-all.zip\">services.gradle.org/distributions/gradle-5.6.4-all.zip</a></p>\n</li>\n<li><p>classpath ‘com.android.tools.build:gradle:3.4.2’classpath ‘com.android.boost.easyconfig:easyconfig:2.6.0’</p>\n</li>\n</ul>\n</li>\n<li><p>apply plugin: ‘com.alipay.apollo.optimize’</p>\n</li>\n<li><p>id ‘com.alipay.apollo.baseline.config’</p>\n</li>\n<li><p>去除所有的alipay的插件</p>\n<ul>\n<li>application和library</li>\n</ul>\n</li>\n<li><p>增加maven管理，目前打包到本地maven仓库，远程maven仓库目前还未申请下来</p>\n</li>\n<li><p>配置maven_push.gradle脚本</p>\n</li>\n<li><p>当前工程配置uploadArchives上传aar到maven仓库</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p> 其他注意点：</p>\n<ul>\n<li><p>1.去除MockLauncherActivityAgent和MockLauncherApplicationAgent，需要将这两个里面的逻辑移植</p>\n</li>\n<li><p>将登录模块和h5模块解耦（目前手机银行登录模块和H5模块存在相互引用的问题）</p>\n</li>\n<li><p>梳理手机银行app启动逻辑（长按应用图标快捷方式、分享启动手机银行等），分析改造影响</p>\n</li>\n</ul></blockquote>\n</li>\n</ul>\n","text":"mPaas目前接入方式有两种，分别是原生AAR模式和组件化方式（Portal&amp;Bundle），AAR模式为后期mPaas推出，手机银行4.0采用的为PB模式。 原生 AAR 方式原生 AAR 接入方式 是指采用原生 Android AAR 打包方案，更贴近 Android...","link":"","photos":[],"count_time":{"symbolsCount":"1.8k","symbolsTime":"2 mins."},"categories":[{"name":"工作","slug":"工作","count":3,"path":"api/categories/工作.json"}],"tags":[{"name":"工作日志","slug":"工作日志","count":3,"path":"api/tags/工作日志.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8E%9F%E7%94%9F-AAR-%E6%96%B9%E5%BC%8F\"><span class=\"toc-text\">原生 AAR 方式</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%BB%84%E4%BB%B6%E5%8C%96%E6%96%B9%E5%BC%8F%EF%BC%88Portal-amp-Bundle%EF%BC%89\"><span class=\"toc-text\">组件化方式（Portal&amp;Bundle）</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E6%8E%A5%E5%85%A5%E6%96%B9%E5%BC%8F\"><span class=\"toc-text\">如何选择接入方式</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%8E%A5%E5%85%A5%E6%96%B9%E5%BC%8F%E5%AF%B9%E6%AF%94\"><span class=\"toc-text\">接入方式对比</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%89%8B%E6%9C%BA%E9%93%B6%E8%A1%8C%E7%94%B1PB%E6%A8%A1%E5%BC%8F%E5%8D%87%E7%BA%A7%E4%B8%BAAAR%E6%A8%A1%E5%BC%8F\"><span class=\"toc-text\">手机银行由PB模式升级为AAR模式</span></a></li></ol></li></ol></li></ol>","author":{"name":"张春博","slug":"blog-author","avatar":"/images/QD20000163.jpg","link":"/","description":"研发及交付中心<br>零售开发组<br>手机银行","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"手机银行新客专题需求月度版本工作记录","uid":"3dc79052ad833c97c9d4021a5676da91","slug":"手机银行新客专题需求月度版本工作记录","date":"2023-02-10T10:14:10.000Z","updated":"2023-03-01T07:56:39.252Z","comments":true,"path":"api/articles/手机银行新客专题需求月度版本工作记录.json","keywords":null,"cover":"/post/手机银行新客专题需求月度版本工作记录/cover.jpeg","text":"需求背景新客户登录手机银行，现生产针对新客户进行了相关功能引导，现为了挺高新客经营成功率，将现有引导进行优化，可引导客户签约相关核心业务； 2.为了更好的营销客户，在相关功能、应用图标、页面根据智能营销客户标签配置不同的引导内容。 需求计划 需求设计：2022/8/31-2022...","link":"","photos":[],"count_time":{"symbolsCount":859,"symbolsTime":"1 mins."},"categories":[{"name":"工作","slug":"工作","count":3,"path":"api/categories/工作.json"}],"tags":[{"name":"工作日志","slug":"工作日志","count":3,"path":"api/tags/工作日志.json"}],"author":{"name":"张春博","slug":"blog-author","avatar":"/images/QD20000163.jpg","link":"/","description":"研发及交付中心<br>零售开发组<br>手机银行","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Hadoop搭建伪分布式集群","uid":"bb0b195ced0db413665f5bd6467e3504","slug":"Hadoop搭建伪分布式集群","date":"2022-05-30T06:07:49.000Z","updated":"2022-05-30T07:50:35.546Z","comments":true,"path":"api/articles/Hadoop搭建伪分布式集群.json","keywords":null,"cover":"/post/Hadoop搭建伪分布式集群/cover.jpeg","text":" Hadoop伪分布式集群即在一台Linux机器上部署Hadoop集群，通过开通不同的端口来实现相应集群搭建。 Hadoop伪分布式集群安装 这张图代表是一台Linux机器，也可以称为是一个节点，上面安装的有JDK环境 最上面的是Hadoop集群会启动的进程，其中NameNode...","link":"","photos":[],"count_time":{"symbolsCount":"7.8k","symbolsTime":"7 mins."},"categories":[{"name":"Hadoop","slug":"Hadoop","count":2,"path":"api/categories/Hadoop.json"}],"tags":[{"name":"Hadoop","slug":"Hadoop","count":2,"path":"api/tags/Hadoop.json"}],"author":{"name":"张春博","slug":"blog-author","avatar":"/images/QD20000163.jpg","link":"/","description":"研发及交付中心<br>零售开发组<br>手机银行","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}