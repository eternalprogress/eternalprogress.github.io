{"title":"mPaas国密改造—MGS切换国密加密","uid":"a8af3c5bc0e2f5651ddfdce68d98b2bf","slug":"mPaas国密改造—MGS切换国密加密","date":"2023-02-17T11:14:10.000Z","updated":"2023-03-01T08:13:46.744Z","comments":true,"path":"api/articles/mPaas国密改造—MGS切换国密加密.json","keywords":null,"cover":"/post/mPaas国密改造—MGS切换国密加密/cover.jpeg","content":"<hr>\n<p>因当前国家信息安全监管总局对金融类App监管要求，涉及到数据安全通信加密算法必须要使用国密的规定。众多使用mPaaS框架的银卡金融客户，因早期大多数都是在网关配置的RSA加密或者ECC加密算法，当接到监管要求后，都要更改网关加密算法为国密，因需求众多mPaaS团队也为此开发了网关同时兼容多个加密方式的功能，去解决客户侧因更换加密算法造成的种种不便和问题。</p>\n<hr>\n<h4 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h4><p>因当前国家信息安全监管总局对金融类App监管要求，涉及到数据安全通信加密算法必须要使用国密的规定。众多使用mPaaS框架的银卡金融客户，因早期大多数都是在网关配置的RSA加密或者ECC加密算法，当接到监管要求后，都要更改网关加密算法为国密，因需求众多mPaaS团队也为此开发了网关同时兼容多个加密方式的功能，去解决客户侧因更换加密算法造成的种种不便和问题。</p>\n<p>以下分别对控制台网关配置和客户端配置，整理更换加密算法方案。初次配置网关加密和客户端配置，参考文档：<a href=\"https://help.aliyun.com/document_detail/72752.html%E3%80%82\">https://help.aliyun.com/document_detail/72752.html。</a></p>\n<h4 id=\"服务端开发平台\"><a href=\"#服务端开发平台\" class=\"headerlink\" title=\"服务端开发平台\"></a>服务端开发平台</h4><ol>\n<li><p>打开移动开发平台-&gt;移动网关-&gt;网关管理：</p>\n<p><img src=\"/post/mPaas%E5%9B%BD%E5%AF%86%E6%94%B9%E9%80%A0%E2%80%94MGS%E5%88%87%E6%8D%A2%E5%9B%BD%E5%AF%86%E5%8A%A0%E5%AF%86/1.png\"></p>\n</li>\n<li><p>这时更换国密，需要提前准备一对已生成的SM2 公、私钥，详细密钥生成方法参考：<a href=\"https://help.aliyun.com/document_detail/64281.htm%E3%80%82\">https://help.aliyun.com/document_detail/64281.htm。</a></p>\n</li>\n<li><p>在控制台-网关管理下，先关闭数据加密，再立刻开启数据加密，这是会出现重新选择加密算法和填写对应密钥的弹窗，如下图。</p>\n<p><img src=\"/post/mPaas%E5%9B%BD%E5%AF%86%E6%94%B9%E9%80%A0%E2%80%94MGS%E5%88%87%E6%8D%A2%E5%9B%BD%E5%AF%86%E5%8A%A0%E5%AF%86/2.png\"></p>\n</li>\n<li><p>将SM2的私钥按正确格式填写到输入框内，点击提交。之后就能在这里看到已经配置好的两种加密方式：</p>\n<p><img src=\"/post/mPaas%E5%9B%BD%E5%AF%86%E6%94%B9%E9%80%A0%E2%80%94MGS%E5%88%87%E6%8D%A2%E5%9B%BD%E5%AF%86%E5%8A%A0%E5%AF%86/2.png\"></p>\n</li>\n</ol>\n<p>介此，网关更换密钥操作已完成。</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><strong>步骤3中必须要先关闭再开启，此时要快速操作，所以请务必先提前生成好对应的SM2公、私钥，且保证正确性和正确格式。</strong></p></blockquote>\n<h4 id=\"客户端\"><a href=\"#客户端\" class=\"headerlink\" title=\"客户端\"></a>客户端</h4><h5 id=\"IOS端\"><a href=\"#IOS端\" class=\"headerlink\" title=\"IOS端\"></a>IOS端</h5><ol>\n<li><p>iOS客户端的加密方式和公钥是配置在info.plist下的，详情见图：</p>\n<p><img src=\"/post/mPaas%E5%9B%BD%E5%AF%86%E6%94%B9%E9%80%A0%E2%80%94MGS%E5%88%87%E6%8D%A2%E5%9B%BD%E5%AF%86%E5%8A%A0%E5%AF%86/4.png\"></p>\n</li>\n<li><p>此时将已生成好的SM2公钥按正确格式替换上述info.plist里PubKey的value，加密算法更改为SM2。</p>\n<p><img src=\"/post/mPaas%E5%9B%BD%E5%AF%86%E6%94%B9%E9%80%A0%E2%80%94MGS%E5%88%87%E6%8D%A2%E5%9B%BD%E5%AF%86%E5%8A%A0%E5%AF%86/5.png\"></p>\n</li>\n</ol>\n<p>介此 iOS端加密方式和公钥也已更换完毕。</p>\n<h5 id=\"Android端\"><a href=\"#Android端\" class=\"headerlink\" title=\"Android端\"></a>Android端</h5><ol>\n<li><p>Android 端的加密方式和公钥是配置在<strong>mpaas_netconfig.properties</strong> 文件下的，如图：</p>\n<p><img src=\"/post/mPaas%E5%9B%BD%E5%AF%86%E6%94%B9%E9%80%A0%E2%80%94MGS%E5%88%87%E6%8D%A2%E5%9B%BD%E5%AF%86%E5%8A%A0%E5%AF%86/6.png\"></p>\n</li>\n<li><p>此时将已生成好的SM2公钥按正确格式替换上述<strong>mpaas_netconfig.properties</strong> 里的对应value，更换后如下图：</p>\n<p><img src=\"/post/mPaas%E5%9B%BD%E5%AF%86%E6%94%B9%E9%80%A0%E2%80%94MGS%E5%88%87%E6%8D%A2%E5%9B%BD%E5%AF%86%E5%8A%A0%E5%AF%86/7.png\"></p>\n</li>\n</ol>\n<p>介此 Android 端加密方式和公钥已更换完毕。</p>\n<h4 id=\"结束语\"><a href=\"#结束语\" class=\"headerlink\" title=\"结束语\"></a>结束语</h4><p>此时服务端和客户端均已更换加密方式完毕，旧版App依然可以正常访问网关，新版App也是可以正常访问网关的，后续需要等待旧版App用户完全升级到新版App后，修改掉网关旧的加密方式即可，当然一直保留也可以的。</p>\n","text":" 因当前国家信息安全监管总局对金融类App监管要求，涉及到数据安全通信加密算法必须要使用国密的规定。众多使用mPaaS框架的银卡金融客户，因早期大多数都是在网关配置的RSA加密或者ECC加密算法，当接到监管要求后，都要更改网关加密算法为国密，因需求众多mPaaS团队也为此开发了网...","link":"","photos":[],"count_time":{"symbolsCount":"1.2k","symbolsTime":"1 mins."},"categories":[{"name":"工作","slug":"工作","count":4,"path":"api/categories/工作.json"}],"tags":[{"name":"工作日志","slug":"工作日志","count":4,"path":"api/tags/工作日志.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E8%83%8C%E6%99%AF\"><span class=\"toc-text\">背景</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0\"><span class=\"toc-text\">服务端开发平台</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%AE%A2%E6%88%B7%E7%AB%AF\"><span class=\"toc-text\">客户端</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#IOS%E7%AB%AF\"><span class=\"toc-text\">IOS端</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Android%E7%AB%AF\"><span class=\"toc-text\">Android端</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E7%BB%93%E6%9D%9F%E8%AF%AD\"><span class=\"toc-text\">结束语</span></a></li></ol>","author":{"name":"张春博","slug":"blog-author","avatar":"/images/QD20000163.jpg","link":"/","description":"研发及交付中心<br>零售开发组<br>手机银行","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"2023年2月24工作周报","uid":"aaf1c992334b402e2ec2402b90704435","slug":"2023年2月24工作周报","date":"2023-02-24T12:14:10.000Z","updated":"2023-03-01T08:18:07.626Z","comments":true,"path":"api/articles/2023年2月24工作周报.json","keywords":null,"cover":"/post/2023年2月24工作周报/cover.jpeg","text":"手机银行专题需求 在建需求8单：2单准生产，2单系统测试，4单开发编码中 【需求-巡视】ALM00026197-关于手机银行利率查询、服务资费更换跳转至新官网页面的需求：系统测试 【项目】ALM00024828-智能营销系统移动端新增产品海报分享及外拓营销的项目一批次：准生产测试...","link":"","photos":[],"count_time":{"symbolsCount":225,"symbolsTime":"1 mins."},"categories":[{"name":"工作","slug":"工作","count":4,"path":"api/categories/工作.json"}],"tags":[{"name":"工作日志","slug":"工作日志","count":4,"path":"api/tags/工作日志.json"}],"author":{"name":"张春博","slug":"blog-author","avatar":"/images/QD20000163.jpg","link":"/","description":"研发及交付中心<br>零售开发组<br>手机银行","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"手机银行新客专题需求月度版本工作记录","uid":"3dc79052ad833c97c9d4021a5676da91","slug":"手机银行新客专题需求月度版本工作记录","date":"2023-02-10T10:14:10.000Z","updated":"2023-03-01T07:56:39.252Z","comments":true,"path":"api/articles/手机银行新客专题需求月度版本工作记录.json","keywords":null,"cover":"/post/手机银行新客专题需求月度版本工作记录/cover.jpeg","text":"需求背景新客户登录手机银行，现生产针对新客户进行了相关功能引导，现为了挺高新客经营成功率，将现有引导进行优化，可引导客户签约相关核心业务； 2.为了更好的营销客户，在相关功能、应用图标、页面根据智能营销客户标签配置不同的引导内容。 需求计划 需求设计：2022/8/31-2022...","link":"","photos":[],"count_time":{"symbolsCount":859,"symbolsTime":"1 mins."},"categories":[{"name":"工作","slug":"工作","count":4,"path":"api/categories/工作.json"}],"tags":[{"name":"工作日志","slug":"工作日志","count":4,"path":"api/tags/工作日志.json"}],"author":{"name":"张春博","slug":"blog-author","avatar":"/images/QD20000163.jpg","link":"/","description":"研发及交付中心<br>零售开发组<br>手机银行","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}